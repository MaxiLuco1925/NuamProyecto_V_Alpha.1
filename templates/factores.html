<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingresar Factores - NUAM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="{% static 'css/listado.css' %}" rel="stylesheet">
</head>
<body>
    <!-- Header NUAM -->
    <header class="nuam-header">
        <div class="container-fluid d-flex justify-content-between align-items-center p-3">
            <img src="{% static 'image/NUAM.png' %}" alt="Logo NUAM" class="nuam-logo-header">
            <h1 class="nuam-title">NUAM</h1>
            <a href="{% url 'panelCalificacion' %}" class="btn btn-info">
                <i class="bi bi-arrow-left me-2"></i>Volver al Panel
            </a>
        </div>
    </header>

    <div class="main-content">
        <h2 class="section-title mb-4">
            <i class="bi bi-calculator me-2"></i>Ingresar Factores Tributarios
        </h2>

        <!-- Información de la Calificación -->
        {% if calificacion %}
        <div class="alert alert-info mb-4">
            <h5><i class="bi bi-info-circle me-2"></i>Información de la Calificación</h5>
            <div class="row">
                <div class="col-md-3">
                    <strong>ID:</strong> #{{ calificacion.id }}
                </div>
                <div class="col-md-3">
                    <strong>Instrumento:</strong> {{ calificacion.instrumento.nombre }}
                </div>
                <div class="col-md-3">
                    <strong>Año Tributario:</strong> {{ calificacion.año_tributario }}
                </div>
                <div class="col-md-3">
                    <strong>Fecha Pago:</strong> {{ calificacion.fecha_pago|date:"d/m/Y" }}
                </div>
            </div>
            {% if calificacion.descripcion %}
            <div class="mt-2">
                <strong>Descripción:</strong> {{ calificacion.descripcion }}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <div class="table-container p-4">
            <form id="formFactores" method="post" class="row g-3">
                {% csrf_token %}
                
                <!-- Switch para ingreso por montos -->
                <div class="col-12">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="ingresoPorMontos" name="ingresoPorMontos">
                        <label class="form-check-label fw-bold" for="ingresoPorMontos">
                            <i class="bi bi-cash-stack me-2"></i>Ingreso por Montos (Activar para calcular automáticamente)
                        </label>
                    </div>
                </div>

                <!-- Sección de Montos -->
                <div id="seccionMontos" class="col-12 mt-3" style="display: none;">
                    <h5 class="mb-3">
                        <i class="bi bi-list-ol me-2"></i>Montos
                    </h5>
                    <div class="row g-3">
                        {% for i in rango_montos %}
                        <div class="col-md-3">
                            <label for="monto_{{ i }}" class="form-label">Monto {{ i }}</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" step="0.01" class="form-control monto-input" 
                                       name="monto_{{ i }}" id="monto_{{ i }}" 
                                       placeholder="0.00" value="0.00">
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="col-12 mt-3">
                        <button type="button" id="btnCalcular" class="btn btn-primary">
                            <i class="bi bi-calculator me-2"></i>Calcular Factores
                        </button>
                    </div>
                </div>

                <!-- Sección de Factores -->
                <div class="col-12 mt-4">
                    <h5 class="mb-3">
                        <i class="bi bi-percent me-2"></i>Factores Tributarios
                    </h5>
                    <div class="row g-3">
                        <!-- Factor 08 -->
                        <div class="col-md-4">
                            <label for="id_factor_8" class="form-label">Factor-08</label>
                            <small class="text-muted d-block">No Constitutiva de Renta No Acogido a Impto.</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_8" name="factor_8" value="0.00">
                        </div>
                        
                        <!-- Factor 09 -->
                        <div class="col-md-4">
                            <label for="id_factor_9" class="form-label">Factor-09</label>
                            <small class="text-muted d-block">Impuesto 1ra Categ. Afecto GL Comp. Con Devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_9" name="factor_9" value="0.00">
                        </div>
                        
                        <!-- Factor 10 -->
                        <div class="col-md-4">
                            <label for="id_factor_10" class="form-label">Factor-10</label>
                            <small class="text-muted d-block">Impuesto Tasa Adicional Evento Art. 21</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_10" name="factor_10" value="0.00">
                        </div>

                        <!-- Factor 11 -->
                        <div class="col-md-4">
                            <label for="id_factor_11" class="form-label">Factor-11</label>
                            <small class="text-muted d-block">Incremento Impuesto 1ra Categoría</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_11" name="factor_11" value="0.00">
                        </div>
                        
                        <!-- Factor 12 -->
                        <div class="col-md-4">
                            <label for="id_factor_12" class="form-label">Factor-12</label>
                            <small class="text-muted d-block">Impuesto 1ra Categ. Evento GL Comp. Con Devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_12" name="factor_12" value="0.00">
                        </div>
                        
                        <!-- Factor 13 -->
                        <div class="col-md-4">
                            <label for="id_factor_13" class="form-label">Factor-13</label>
                            <small class="text-muted d-block">Ingresos afectados a GI con derecho a compensación sin devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_13" name="factor_13" value="0.00">
                        </div>

                        <!-- Factor 14 -->
                        <div class="col-md-4">
                            <label for="id_factor_14" class="form-label">Factor-14</label>
                            <small class="text-muted d-block">Ingresos Exentos de GI con derecho a compensación sin devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_14" name="factor_14" value="0.00">
                        </div>

                        <!-- Factor 15 -->
                        <div class="col-md-4">
                            <label for="id_factor_15" class="form-label">Factor-15</label>
                            <small class="text-muted d-block">Ingresos sujetos a crédito por impuestos internos</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_15" name="factor_15" value="0.00">
                        </div>

                        <!-- Factor 16 -->
                        <div class="col-md-4">
                            <label for="id_factor_16" class="form-label">Factor-16</label>
                            <small class="text-muted d-block">Ingresos no constitutivos de renta acogidos a impuesto</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_16" name="factor_16" value="0.00">
                        </div>

                        <!-- Factor 17 -->
                        <div class="col-md-4">
                            <label for="id_factor_17" class="form-label">Factor-17</label>
                            <small class="text-muted d-block">Ingresos que consideran devolución de capital no constitutiva de renta</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_17" name="factor_17" value="0.00">
                        </div>

                        <!-- Factor 18 -->
                        <div class="col-md-4">
                            <label for="id_factor_18" class="form-label">Factor-18</label>
                            <small class="text-muted d-block">Ingresos que se consideran exentos de IGC y/o IA</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_18" name="factor_18" value="0.00">
                        </div>

                        <!-- Factor 19 -->
                        <div class="col-md-4">
                            <label for="id_factor_19" class="form-label">Factor-19</label>
                            <small class="text-muted d-block">Ingresos no constitutivos de Renta</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_19" name="factor_19" value="0.00">
                        </div>

                        <!-- Factor 20 -->
                        <div class="col-md-4">
                            <label for="id_factor_20" class="form-label">Factor-20</label>
                            <small class="text-muted d-block">Ingresos con crédito sin derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_20" name="factor_20" value="0.00">
                        </div>

                        <!-- Factor 21 -->
                        <div class="col-md-4">
                            <label for="id_factor_21" class="form-label">Factor-21</label>
                            <small class="text-muted d-block">Ingresos con derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_21" name="factor_21" value="0.00">
                        </div>

                        <!-- Factor 22 -->
                        <div class="col-md-4">
                            <label for="id_factor_22" class="form-label">Factor-22</label>
                            <small class="text-muted d-block">Ingresos sin derecho a devolución ni imputación directa</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_22" name="factor_22" value="0.00">
                        </div>

                        <!-- Factor 23 -->
                        <div class="col-md-4">
                            <label for="id_factor_23" class="form-label">Factor-23</label>
                            <small class="text-muted d-block">Ingresos con derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_23" name="factor_23" value="0.00">
                        </div>

                        <!-- Factor 24 -->
                        <div class="col-md-4">
                            <label for="id_factor_24" class="form-label">Factor-24</label>
                            <small class="text-muted d-block">Ingresos con crédito sin derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_24" name="factor_24" value="0.00">
                        </div>

                        <!-- Factor 25 -->
                        <div class="col-md-4">
                            <label for="id_factor_25" class="form-label">Factor-25</label>
                            <small class="text-muted d-block">Ingresos con derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_25" name="factor_25" value="0.00">
                        </div>

                        <!-- Factor 26 -->
                        <div class="col-md-4">
                            <label for="id_factor_26" class="form-label">Factor-26</label>
                            <small class="text-muted d-block">Sin derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_26" name="factor_26" value="0.00">
                        </div>

                        <!-- Factor 27 -->
                        <div class="col-md-4">
                            <label for="id_factor_27" class="form-label">Factor-27</label>
                            <small class="text-muted d-block">Con derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_27" name="factor_27" value="0.00">
                        </div>

                        <!-- Factor 28 -->
                        <div class="col-md-4">
                            <label for="id_factor_28" class="form-label">Factor-28</label>
                            <small class="text-muted d-block">Crédito por IPE</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_28" name="factor_28" value="0.00">
                        </div>

                        <!-- Factor 29 -->
                        <div class="col-md-4">
                            <label for="id_factor_29" class="form-label">Factor-29</label>
                            <small class="text-muted d-block">Sin derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_29" name="factor_29" value="0.00">
                        </div>

                        <!-- Factor 30 -->
                        <div class="col-md-4">
                            <label for="id_factor_30" class="form-label">Factor-30</label>
                            <small class="text-muted d-block">Con derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_30" name="factor_30" value="0.00">
                        </div>

                        <!-- Factor 31 -->
                        <div class="col-md-4">
                            <label for="id_factor_31" class="form-label">Factor-31</label>
                            <small class="text-muted d-block">Sin derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_31" name="factor_31" value="0.00">
                        </div>

                        <!-- Factor 32 -->
                        <div class="col-md-4">
                            <label for="id_factor_32" class="form-label">Factor-32</label>
                            <small class="text-muted d-block">Con derecho a devolución</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_32" name="factor_32" value="0.00">
                        </div>

                        <!-- Factor 33 -->
                        <div class="col-md-4">
                            <label for="id_factor_33" class="form-label">Factor-33</label>
                            <small class="text-muted d-block">Crédito por IPE</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_33" name="factor_33" value="0.00">
                        </div>

                        <!-- Factor 34 -->
                        <div class="col-md-4">
                            <label for="id_factor_34" class="form-label">Factor-34</label>
                            <small class="text-muted d-block">Cred. Por impto. Tasa adicional, Ex art 21 LIE</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_34" name="factor_34" value="0.00">
                        </div>

                        <!-- Factor 35 -->
                        <div class="col-md-4">
                            <label for="id_factor_35" class="form-label">Factor-35</label>
                            <small class="text-muted d-block">Tasa efectiva del Cred. del FUT (TEF)</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_35" name="factor_35" value="0.00">
                        </div>

                        <!-- Factor 36 -->
                        <div class="col-md-4">
                            <label for="id_factor_36" class="form-label">Factor-36</label>
                            <small class="text-muted d-block">Tasa Efectiva del Cred. del FUNT (TEX)</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_36" name="factor_36" value="0.00">
                        </div>

                        <!-- Factor 37 -->
                        <div class="col-md-4">
                            <label for="id_factor_37" class="form-label">Factor-37</label>
                            <small class="text-muted d-block">Devolución de Capital Art. 17 num 7 LIR</small>
                            <input type="number" step="0.01" class="form-control factor-input" 
                                   id="id_factor_37" name="factor_37" value="0.00">
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="col-12 text-center mt-4">
                    <button type="submit" class="btn btn-success btn-lg me-2">
                        <i class="bi bi-save me-2"></i>Guardar Factores
                    </button>
                    <a href="{% url 'ingresarCalificacion' %}" class="btn btn-secondary btn-lg">
                        <i class="bi bi-x-circle me-2"></i>Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script src="{% static 'js/calculo_montos.js' %}"></script>
</body>
</html>